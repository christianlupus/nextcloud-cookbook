@startuml

namespace OCA.Cookbook {
	
	namespace Entity {
		
		interface Entity {
			+persist()
			+remove()
		}
		
		interface RecipeEntity {
			--
			+ getId() : int
			+ getName() : string
			+ setName(string) : void
			..
			+ getCategory() : CategoryEntity
			+ setCategory(CategoryEntity) : void
			+ getKeywords() : array
			+ addKeyword(KeywordEntity) : void
			+ removeKeyword(KeywordEntity) : void
		}
		
		interface CategoryEntity {
			--
			+ getName() : string
			+ setName(string) : void
			..
			+ getRecipes() : array
		}
		
		interface KeywordEntity {
			--
			+ getName() : string
			+ setName(string) : void
			..
			+ getRecipes() : array
		}
		
		
		namespace impl {
			
'			class AbstractEntity {}
			
			abstract class AbstractEntity {
				- bool persisted
				+ isPersisted() : bool
				+ clone() : ImplEntity
				+ isSame(AbstractEntity) : bool
				+ equals(AbstractEntity) : bool
			}
			
			class RecipeEntityImpl {
				#id
				#name
				#userId
				# RecipeDbWrapper wrapper
			}
			
			class CategoryEntityImpl {
				#name
				# CategoryDbWrapper wrapper
			}
			
			class KeywordEntityImpl {
				#name
				# KeywordDbWrapper wrapper
			}
			
			class CategoryMappingEntity {
				# CategoryMappingDbWrapper wrapper
			}
			
			class KeywordMappingEntity {
				# KeywordMappingDbWrapper wrapper
			}
			
'			AbstractEntity <|-- RecipeEntity
'			AbstractEntity <|-- CategoryEntity
'			AbstractEntity <|-- KeywordEntity
'			AbstractEntity <|-- OCA\Cookbook.Entity.impl.KeywordMappingEntity
			
/'			ImplEntity <|. RecipeEntityImpl
			ImplEntity <|. CategoryEntityImpl
			ImplEntity <|. KeywordEntityImpl
			ImplEntity <|. CategoryMappingEntity
			ImplEntity <|. KeywordMappingEntity'/
			
			RecipeEntityImpl --|> AbstractEntity
			CategoryEntityImpl --|> AbstractEntity
			KeywordEntityImpl --|> AbstractEntity
			CategoryMappingEntity --|> AbstractEntity
			KeywordMappingEntity --|> AbstractEntity
			
			RecipeEntityImpl "1" *-- "0..1" OCA.Cookbook.Entity.impl.CategoryMappingEntity
			CategoryEntityImpl "1" *-- "*" OCA.Cookbook.Entity.impl.CategoryMappingEntity
			
			RecipeEntityImpl "1" *-- "*" OCA.Cookbook.Entity.impl.KeywordMappingEntity
			KeywordEntityImpl "1" *-- "*" OCA.Cookbook.Entity.impl.KeywordMappingEntity
			
		}
		
		RecipeEntity <|.. OCA.Cookbook.Entity.impl.RecipeEntityImpl
		CategoryEntity <|.. OCA.Cookbook.Entity.impl.CategoryEntityImpl
		KeywordEntity <|.. OCA.Cookbook.Entity.impl.KeywordEntityImpl
		
		Entity <|.. RecipeEntity
		Entity <|.. CategoryEntity
		Entity <|.. KeywordEntity
		
	}
	
	namespace Db {
		
		abstract class AbstractDbWrapper {
			# IDbConnection db
			+ abstract createEntity() : Entity
			- array cache
			- bool cacheValid
			# abstract fetchDatabase() : array
			+ getEntites() : array
			# setCache(array) : void
			+ getServiceLocator() : DbWrapperSerciveLocator
		}
		note right
		Cache representys the current state
		of the database tables as clones.
		endnote
		
		class RecipeDbWrapper {
			'--
			+ createEntity() : RecipeEntityImpl
			+ store(RecipeEntityImpl) : void
			- storeNew(RecipeEntityImpl) : void
			- update(RecipeEntityImpl) : void
			/'..
			+ addKeyword(RecipeEntityImpl, KeywordEntityImpl) : KeywordMappingEntity
			+ setCategory(RecipeEntityImpl, CategoryEntityImpl) : CategoryMappingEntity'/
		}
		class CategoryDbWrapper {
			+ createEntity() : CategoryEntityImpl
			+ store(CategoryEntityImpl) : void
			- storeNew(CategoryEntityImpl) : void
			- update(CategoryEntityImpl) : void
		}
		class KeywordDbWrapper {
			+ createEntity() : KeywordEntityImpl
			+ store(KeywordEntityImpl) : void
			- storeNew(KeywordEntityImpl) : void
			- update(KeywordEntityImpl) : void
		}
		class CategoryMappingDbWrapper {
			+ createEntity() : CategoryMappingEntity
		}
		class KeywordMappingDbWrapper {
			+ createEntity() : KeywordMappingEntity
		}
		
		class DbWrapperSerciveLocator {
			+ getRecipeDbWrapoper() : RecipeDbWrapper
			+ getCategoryDbWrapper() : CategoryDbWrapper
			+ getKeywordDbWrapper() : KeywordDbWrapper
			+ getCategoryMappingDbWrapper() : CategoryMappingDbWrapper
			+ getKeywordMappingDbWrapper() : KeywordMappingDbWrapper
		}
		
		AbstractDbWrapper <|-- RecipeDbWrapper
		AbstractDbWrapper <|-- CategoryDbWrapper
		AbstractDbWrapper <|-- KeywordDbWrapper
		AbstractDbWrapper <|-- CategoryMappingDbWrapper
		AbstractDbWrapper <|-- KeywordMappingDbWrapper
		
		RecipeDbWrapper "1" o-- "1" DbWrapperSerciveLocator
		CategoryDbWrapper "1" o-- "1" DbWrapperSerciveLocator
		KeywordDbWrapper "1" o-- "1" DbWrapperSerciveLocator
		CategoryMappingDbWrapper "1" o-- "1" DbWrapperSerciveLocator
		KeywordMappingDbWrapper "1" o-- "1" DbWrapperSerciveLocator
	}
	
}

@enduml
